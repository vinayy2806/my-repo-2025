Creating IAM User with a Custom Policy and Attachments

provider "aws" {
  region = "us-east-1"
}

# Create IAM User
resource "aws_iam_user" "Microdegree_user" {
  name = "Microdegree_user"
}

# Create Custom IAM Policy
resource "aws_iam_policy" "Microdegree_policy" {
  name        = "Microdegree-policy"
  description = "A custom IAM policy for S3 access"
  policy      = jsonencode({
    Version = "2012-10-17"
    Statement = [
      {
        Effect   = "Allow"
        Action   = "s3:ListBucket"
        Resource = "arn:aws:s3:::Microdegree-bucket"
      }
    ]
  })
}

# Attach the Custom Policy to the User
resource "aws_iam_user_policy_attachment" "Microdegree_user_policy" {
  user       = aws_iam_user.Microdegree_user.name
  policy_arn = aws_iam_policy.Microdegree_policy.arn
}

# Create IAM Group
resource "aws_iam_group" "Microdegree_group" {
  name = "Microdegree_group"
}

# Add User to Group
resource "aws_iam_user_group_membership" "Microdegree_group_membership" {
  user   = aws_iam_user.Microdegree_user.name
  groups = [aws_iam_group.Microdegree_group.name]
}

# Attach the Custom Policy to the Group
resource "aws_iam_group_policy_attachment" "Microdegree_group_policy" {
  group      = aws_iam_group.Microdegree_group.name
  policy_arn = aws_iam_policy.Microdegree_policy.arn
}

